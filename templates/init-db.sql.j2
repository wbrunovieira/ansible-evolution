-- Evolution API PostgreSQL Initialization Script
-- Generated by Ansible

-- Create schema if not exists
CREATE SCHEMA IF NOT EXISTS public;

-- Grant privileges
GRANT ALL ON SCHEMA public TO {{ postgres_user }};
GRANT ALL ON SCHEMA public TO public;

-- Create extensions if needed
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pgcrypto";

-- Set default search path
ALTER DATABASE {{ postgres_db }} SET search_path TO public;

-- Performance tuning
ALTER DATABASE {{ postgres_db }} SET shared_preload_libraries = 'pg_stat_statements';
ALTER DATABASE {{ postgres_db }} SET max_connections = 200;
ALTER DATABASE {{ postgres_db }} SET shared_buffers = '256MB';
ALTER DATABASE {{ postgres_db }} SET effective_cache_size = '1GB';
ALTER DATABASE {{ postgres_db }} SET maintenance_work_mem = '64MB';

-- Create initial tables will be handled by Evolution API migrations