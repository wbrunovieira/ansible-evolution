# Evolution API Environment Variables
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

# Server Configuration
SERVER_TYPE=http
SERVER_PORT=8080
SERVER_URL={{ evolution_protocol }}://{{ evolution_domain }}

# Database Configuration
DATABASE_PROVIDER=postgresql
DATABASE_CONNECTION_URI={{ vault_database_connection_uri }}
DATABASE_CONNECTION_CLIENT_NAME=evolution_{{ inventory_hostname }}
POSTGRES_PASSWORD={{ vault_postgres_password }}

# Redis Configuration
CACHE_REDIS_ENABLED=true
CACHE_REDIS_URI={{ vault_redis_uri }}
CACHE_REDIS_PREFIX_KEY=evolution
CACHE_REDIS_TTL=604800
CACHE_LOCAL_ENABLED=false
REDIS_PASSWORD={{ vault_redis_password }}

# Authentication
AUTHENTICATION_API_KEY={{ vault_evolution_api_key }}
AUTHENTICATION_JWT_SECRET={{ vault_jwt_secret }}
AUTHENTICATION_JWT_EXPIRESIN=0
AUTHENTICATION_INSTANCE_MODE=server
AUTHENTICATION_INSTANCE_NAME=evolution
AUTHENTICATION_INSTANCE_WEBHOOK_URL=
AUTHENTICATION_INSTANCE_CHATWOOT_ACCOUNT_ID=
AUTHENTICATION_INSTANCE_CHATWOOT_TOKEN=
AUTHENTICATION_INSTANCE_CHATWOOT_URL=

# CORS Configuration
CORS_ORIGIN=*
CORS_METHODS=POST,GET,PUT,DELETE
CORS_CREDENTIALS={{ evolution_cors_enabled | lower }}
CORS_ALLOWED_HEADERS=Content-Type,Authorization

# Logging
LOG_LEVEL={{ evolution_log_level }}
LOG_COLOR={{ evolution_log_color | lower }}
LOG_BAILEYS=error

# Instance Configuration
CONFIG_SESSION_PHONE_VERSION=2.3000.1023204200
CONFIG_SESSION_PHONE_NAME=Evolution API
CONFIG_SESSION_PHONE_CLIENT=evolution-api

# QR Code Settings
QRCODE_COLOR=#009879
QRCODE_BACKGROUND=#FFFFFF

# Webhook Settings
{% if enable_webhook %}
WEBHOOK_GLOBAL_ENABLED=true
WEBHOOK_GLOBAL_URL={{ webhook_global_url | default('') }}
WEBHOOK_GLOBAL_WEBHOOK_BY_EVENTS=false
{% else %}
WEBHOOK_GLOBAL_ENABLED=false
{% endif %}
WEBHOOK_EVENTS_APPLICATION_STARTUP=false
WEBHOOK_EVENTS_INSTANCE_CREATE=true
WEBHOOK_EVENTS_INSTANCE_DELETE=true
WEBHOOK_EVENTS_QRCODE_UPDATED=true
WEBHOOK_EVENTS_MESSAGES_SET=true
WEBHOOK_EVENTS_MESSAGES_UPSERT=true
WEBHOOK_EVENTS_MESSAGES_EDITED=true
WEBHOOK_EVENTS_MESSAGES_UPDATE=true
WEBHOOK_EVENTS_MESSAGES_DELETE=true
WEBHOOK_EVENTS_SEND_MESSAGE=true
WEBHOOK_EVENTS_CONTACTS_SET=true
WEBHOOK_EVENTS_CONTACTS_UPSERT=true
WEBHOOK_EVENTS_CONTACTS_UPDATE=true
WEBHOOK_EVENTS_PRESENCE_UPDATE=true
WEBHOOK_EVENTS_CHATS_SET=true
WEBHOOK_EVENTS_CHATS_UPSERT=true
WEBHOOK_EVENTS_CHATS_UPDATE=true
WEBHOOK_EVENTS_CHATS_DELETE=true
WEBHOOK_EVENTS_GROUPS_UPSERT=true
WEBHOOK_EVENTS_GROUPS_UPDATE=true
WEBHOOK_EVENTS_GROUP_PARTICIPANTS_UPDATE=true
WEBHOOK_EVENTS_CONNECTION_UPDATE=true
WEBHOOK_EVENTS_LABELS_EDIT=true
WEBHOOK_EVENTS_LABELS_ASSOCIATION=true
WEBHOOK_EVENTS_CALL=true
WEBHOOK_EVENTS_NEW_JWT_TOKEN=false
WEBHOOK_EVENTS_TYPEBOT_START=false
WEBHOOK_EVENTS_TYPEBOT_CHANGE_STATUS=false
WEBHOOK_EVENTS_ERRORS=true
WEBHOOK_EVENTS_ERRORS_WEBHOOK=true

# RabbitMQ Settings
{% if enable_rabbitmq %}
RABBITMQ_ENABLED=true
RABBITMQ_URI=amqp://{{ vault_rabbitmq_user }}:{{ vault_rabbitmq_password }}@rabbitmq:5672
RABBITMQ_EXCHANGE_NAME=evolution_exchange
RABBITMQ_GLOBAL_ENABLED=true
RABBITMQ_EVENTS_APPLICATION_STARTUP=true
RABBITMQ_EVENTS_INSTANCE_CREATE=true
RABBITMQ_EVENTS_INSTANCE_DELETE=true
RABBITMQ_EVENTS_QRCODE_UPDATED=true
RABBITMQ_EVENTS_MESSAGES_SET=true
RABBITMQ_EVENTS_MESSAGES_UPSERT=true
RABBITMQ_EVENTS_MESSAGES_EDITED=true
RABBITMQ_EVENTS_MESSAGES_UPDATE=true
RABBITMQ_EVENTS_MESSAGES_DELETE=true
RABBITMQ_EVENTS_SEND_MESSAGE=true
RABBITMQ_EVENTS_CONTACTS_SET=true
RABBITMQ_EVENTS_CONTACTS_UPSERT=true
RABBITMQ_EVENTS_CONTACTS_UPDATE=true
RABBITMQ_EVENTS_PRESENCE_UPDATE=true
RABBITMQ_EVENTS_CHATS_SET=true
RABBITMQ_EVENTS_CHATS_UPSERT=true
RABBITMQ_EVENTS_CHATS_UPDATE=true
RABBITMQ_EVENTS_CHATS_DELETE=true
RABBITMQ_EVENTS_GROUPS_UPSERT=true
RABBITMQ_EVENTS_GROUPS_UPDATE=true
RABBITMQ_EVENTS_GROUP_PARTICIPANTS_UPDATE=true
RABBITMQ_EVENTS_CONNECTION_UPDATE=true
RABBITMQ_EVENTS_LABELS_EDIT=true
RABBITMQ_EVENTS_LABELS_ASSOCIATION=true
RABBITMQ_EVENTS_CALL=true
RABBITMQ_EVENTS_NEW_JWT_TOKEN=false
RABBITMQ_EVENTS_TYPEBOT_START=false
RABBITMQ_EVENTS_TYPEBOT_CHANGE_STATUS=false
RABBITMQ_EVENTS_ERRORS=true
RABBITMQ_EVENTS_ERRORS_WEBHOOK=true
{% else %}
RABBITMQ_ENABLED=false
{% endif %}

# WebSocket Settings
{% if enable_websocket %}
WEBSOCKET_ENABLED=true
WEBSOCKET_GLOBAL_EVENTS=true
{% else %}
WEBSOCKET_ENABLED=false
{% endif %}

# S3/MinIO Settings
{% if enable_s3 %}
S3_ENABLED=true
S3_ACCESS_KEY={{ vault_s3_access_key }}
S3_SECRET_KEY={{ vault_s3_secret_key }}
S3_BUCKET=evolution
S3_PORT=9000
S3_ENDPOINT=s3.wbdigitalsolutions.com
S3_USE_SSL=true
{% else %}
S3_ENABLED=false
{% endif %}

# Typebot Settings
{% if enable_typebot %}
TYPEBOT_ENABLED=true
TYPEBOT_API_VERSION=v1
{% else %}
TYPEBOT_ENABLED=false
{% endif %}

# Chatwoot Settings
{% if enable_chatwoot %}
CHATWOOT_ENABLED=true
CHATWOOT_ACCOUNT_ID={{ chatwoot_account_id | default('') }}
CHATWOOT_TOKEN={{ vault_chatwoot_token }}
CHATWOOT_URL={{ chatwoot_url | default('') }}
CHATWOOT_SIGN_MSG=true
CHATWOOT_REOPEN_CONVERSATION=true
CHATWOOT_CONVERSATION_PENDING=false
CHATWOOT_MERGE_BRAZIL_CONTACTS=true
CHATWOOT_IMPORT_DATABASE_CONNECTION_URI={{ vault_database_connection_uri }}
CHATWOOT_IMPORT_DATABASE_PLACEHOLDER_MEDIA_MESSAGE=true
{% else %}
CHATWOOT_ENABLED=false
{% endif %}

# OpenAI Settings
{% if enable_openai %}
OPENAI_ENABLED=true
OPENAI_API_KEY={{ vault_openai_api_key }}
OPENAI_ASSISTANT={{ openai_assistant | default('') }}
OPENAI_ORGANIZATION_ID={{ openai_organization | default('') }}
{% else %}
OPENAI_ENABLED=false
{% endif %}

# Dify Settings
{% if enable_dify %}
DIFY_ENABLED=true
DIFY_API_KEY={{ vault_dify_api_key }}
DIFY_API_URL={{ dify_api_url | default('') }}
{% else %}
DIFY_ENABLED=false
{% endif %}


# Timezone
TZ=America/Sao_Paulo

# Node Environment
NODE_ENV=production